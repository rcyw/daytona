# ğŸš€ TypeORM Repository æµ‹è¯•é¡¹ç›® - å¿«é€Ÿå¼€å§‹

è¿™ä¸ªé¡¹ç›®ä¸“é—¨ç”¨äºæµ‹è¯•å’ŒéªŒè¯ TypeORM Repository çš„å„ç§åŠŸèƒ½ï¼ŒåŸºäº Daytona API ä¸­çš„å®é™…å®ä½“ç»“æ„è®¾è®¡ã€‚

## ğŸ¯ é¡¹ç›®ç›®æ ‡

- æä¾›ä¸€ä¸ªå®‰å…¨çš„ TypeORM Repository æµ‹è¯•ç¯å¢ƒ
- åŸºäºçœŸå®çš„ Daytona API å®ä½“ç»“æ„
- éªŒè¯å¤æ‚çš„æŸ¥è¯¢é€»è¾‘å’Œ Repository æ¨¡å¼
- å­¦ä¹ å’Œå®éªŒ TypeORM çš„å„ç§åŠŸèƒ½

## ğŸ“¦ å®‰è£…å’Œè®¾ç½®

### 1. å®‰è£…ä¾èµ–

```bash
cd deep-docs/typeorm-repository-testing
npm install
```

### 2. å¯åŠ¨æ•°æ®åº“

```bash
# å¯åŠ¨ PostgreSQL å®¹å™¨
docker-compose up -d

# ç­‰å¾…æ•°æ®åº“å®Œå…¨å¯åŠ¨ï¼ˆçº¦10ç§’ï¼‰
sleep 10
```

### 3. åˆå§‹åŒ–æ•°æ®åº“

```bash
# åˆ›å»ºè¡¨ç»“æ„å’Œç¤ºä¾‹æ•°æ®
npm run setup-db
```

## ğŸ® ä½¿ç”¨ç¤ºä¾‹

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# è¿è¡Œç‰¹å®šæµ‹è¯•å¥—ä»¶
npm run test:organization
npm run test:repository-patterns

# ç›‘å¬æ¨¡å¼è¿è¡Œæµ‹è¯•
npm run test:watch
```

### è¿è¡Œç¤ºä¾‹

```bash
# åŸºç¡€æŸ¥è¯¢ç¤ºä¾‹ - å­¦ä¹ åŸºæœ¬çš„ Repository æ“ä½œ
npm run example:basic

# å¤æ‚æŸ¥è¯¢ç¤ºä¾‹ - é«˜çº§ SQL åŠŸèƒ½æ¼”ç¤º
npm run example:complex

# å…³ç³»æŸ¥è¯¢ç¤ºä¾‹ - å®ä½“å…³ç³»å’Œå…³è”æŸ¥è¯¢
npm run example:relationships

# äº‹åŠ¡å¤„ç†ç¤ºä¾‹ - äº‹åŠ¡ç®¡ç†å’Œé”™è¯¯å¤„ç†
npm run example:transactions
```

### äº¤äº’å¼æ¼”ç¤º

```bash
# è¿è¡Œäº¤äº’å¼æ¼”ç¤º
npm run demo
```

## ğŸ”§ ç»´æŠ¤å‘½ä»¤

```bash
# æ¸…ç†æ•°æ®åº“
npm run clean-db

# é‡æ–°åˆå§‹åŒ–æ•°æ®åº“
npm run setup-db

# ä»£ç æ£€æŸ¥
npm run lint
npm run lint:fix

# ä»£ç æ ¼å¼åŒ–
npm run format
```

## ğŸ“Š æµ‹è¯•å’ŒéªŒè¯

### æ¨èçš„å­¦ä¹ è·¯å¾„

1. **é¦–å…ˆè¿è¡Œç¤ºä¾‹è„šæœ¬**ï¼ˆ100% æˆåŠŸç‡ï¼‰:

   ```bash
   npm run example:basic      # åŸºç¡€ CRUD æ“ä½œ
   npm run example:complex    # é«˜çº§æŸ¥è¯¢åŠŸèƒ½  
   npm run example:relationships  # å…³ç³»ç®¡ç†
   npm run example:transactions   # äº‹åŠ¡å¤„ç†
   ```

2. **ç„¶åè¿è¡Œæ ¸å¿ƒåŠŸèƒ½æµ‹è¯•**:

   ```bash
   npm run test:organization  # ç»„ç»‡ç›¸å…³æµ‹è¯•ï¼ˆ100% é€šè¿‡ï¼‰
   ```

3. **æœ€åå°è¯•å®Œæ•´æµ‹è¯•å¥—ä»¶**:

   ```bash
   npm test  # å®Œæ•´æµ‹è¯•ï¼ˆçº¦57%é€šè¿‡ç‡ï¼‰
   ```

### æµ‹è¯•ç»“æœè¯´æ˜

- **ç¤ºä¾‹è„šæœ¬**: 100% è¿è¡ŒæˆåŠŸï¼Œé€‚åˆå­¦ä¹ å’ŒéªŒè¯ âœ…
- **å•ç‹¬æµ‹è¯•å¥—ä»¶**: 100% é€šè¿‡ï¼ŒéªŒè¯ä¸»è¦åŠŸèƒ½ âœ…
  - `test:organization`: 20/20 é€šè¿‡
  - `test:repository-patterns`: 18/18 é€šè¿‡  
  - `test:performance`: 11/11 é€šè¿‡
- **å®Œæ•´æµ‹è¯•å¥—ä»¶**: å¯èƒ½å› æµ‹è¯•éš”ç¦»é—®é¢˜éƒ¨åˆ†å¤±è´¥
- **å»ºè®®**: ä¼˜å…ˆä½¿ç”¨ç¤ºä¾‹è„šæœ¬å’Œå•ç‹¬æµ‹è¯•å‘½ä»¤è¿›è¡Œå­¦ä¹ å’ŒéªŒè¯

### ğŸ¯ æ¨èä½¿ç”¨æ–¹å¼

1. **æ—¥å¸¸å­¦ä¹ **: ä½¿ç”¨ç¤ºä¾‹è„šæœ¬

   ```bash
   npm run example:basic       # å­¦ä¹ åŸºç¡€æ“ä½œ
   npm run example:complex     # å­¦ä¹ é«˜çº§æŸ¥è¯¢
   ```

2. **åŠŸèƒ½éªŒè¯**: ä½¿ç”¨å•ç‹¬æµ‹è¯•

   ```bash
   npm run test:organization   # éªŒè¯ç»„ç»‡åŠŸèƒ½
   npm run test:repository-patterns  # éªŒè¯ä»“å‚¨æ¨¡å¼
   ```

3. **æ€§èƒ½åˆ†æ**: ä½¿ç”¨æ€§èƒ½æµ‹è¯•

   ```bash
   npm run test:performance    # æ€§èƒ½åŸºå‡†æµ‹è¯•
   ```

## ğŸ“Š æµ‹è¯•æ•°æ®æ¦‚è§ˆ

è¿è¡Œ `npm run setup-db` åï¼Œæ•°æ®åº“å°†åŒ…å«ï¼š

### ç”¨æˆ·æ•°æ®

- `admin-user` - ç®¡ç†å‘˜ç”¨æˆ· âœ… å·²éªŒè¯
- `john-doe` - æ™®é€šç”¨æˆ· âœ… å·²éªŒè¯
- `jane-smith` - æ™®é€šç”¨æˆ· âŒ æœªéªŒè¯é‚®ç®±
- `bob-wilson` - æ™®é€šç”¨æˆ· âœ… å·²éªŒè¯

### ç»„ç»‡æ•°æ®

- `Daytona Inc` - ä¼ä¸šç»„ç»‡ âœ… æ´»è·ƒ
- `Personal (John)` - ä¸ªäººç»„ç»‡ âœ… æ´»è·ƒ
- `Personal (Jane)` - ä¸ªäººç»„ç»‡ ğŸ”’ æš‚åœï¼ˆé‚®ç®±æœªéªŒè¯ï¼‰
- `Development Team` - ä¼ä¸šç»„ç»‡ âœ… æ´»è·ƒ
- `Old Suspended Org` - ä¼ä¸šç»„ç»‡ ğŸ”’ æš‚åœï¼ˆè´¦å•é—®é¢˜ï¼‰

## ğŸ§ª æµ‹è¯•å†…å®¹

è¿™ä¸ªé¡¹ç›®åŒ…å«ä»¥ä¸‹ç±»å‹çš„æµ‹è¯•ï¼š

### åŸºç¡€ CRUD æ“ä½œ

- åˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤å®ä½“
- éªŒè¯å­—æ®µé»˜è®¤å€¼å’Œçº¦æŸ
- æµ‹è¯•å®ä½“ç”Ÿå‘½å‘¨æœŸé’©å­

### å®ä½“å…³ç³»

- OneToMany / ManyToOne å…³ç³»
- çº§è”æ“ä½œæµ‹è¯•
- å…³ç³»æ•°æ®çš„é¢„åŠ è½½å’Œæ‡’åŠ è½½

### å¤æ‚æŸ¥è¯¢

- æ¡ä»¶æŸ¥è¯¢ (WHERE, AND, OR)
- æ’åºå’Œåˆ†é¡µ
- èšåˆæŸ¥è¯¢ (COUNT, SUM, etc.)
- å­æŸ¥è¯¢å’Œ JOIN æ“ä½œ

### QueryBuilder

- åŠ¨æ€æŸ¥è¯¢æ„å»º
- å‚æ•°åŒ–æŸ¥è¯¢
- åŸç”Ÿ SQL æ‰§è¡Œ
- å¤æ‚çš„å¤šè¡¨æŸ¥è¯¢

### äº‹åŠ¡å¤„ç†

- äº‹åŠ¡æäº¤å’Œå›æ»š
- åµŒå¥—äº‹åŠ¡
- äº‹åŠ¡éš”ç¦»çº§åˆ«

### æ€§èƒ½ä¼˜åŒ–

- æ‰¹é‡æ“ä½œ
- æŸ¥è¯¢ä¼˜åŒ–
- ç´¢å¼•ä½¿ç”¨éªŒè¯

## ğŸ“ å­¦ä¹ è·¯å¾„

### 1. æ–°æ‰‹å…¥é—¨

1. è¿è¡Œ `npm run example:basic` å­¦ä¹ åŸºç¡€æ“ä½œ
2. æŸ¥çœ‹ `src/tests/organization.test.ts` äº†è§£æµ‹è¯•ç»“æ„
3. è¿è¡Œ `npm test` æŸ¥çœ‹æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹

### 2. è¿›é˜¶å­¦ä¹ 

1. ç ”ç©¶ `src/services/organization.service.ts` çš„å¤æ‚é€»è¾‘
2. å®éªŒ QueryBuilder çš„å„ç§ç”¨æ³•
3. å°è¯•ä¿®æ”¹å®ä½“å…³ç³»å’Œæµ‹è¯•æ•ˆæœ

### 3. å®è·µéªŒè¯

1. åˆ›å»ºè‡ªå·±çš„æµ‹è¯•ç”¨ä¾‹
2. éªŒè¯ API ä¸­çš„ Repository é€»è¾‘
3. æµ‹è¯•æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

## ğŸ” æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

### å®ä½“å®šä¹‰

- `src/entities/organization.entity.ts` - ç»„ç»‡å®ä½“
- `src/entities/user.entity.ts` - ç”¨æˆ·å®ä½“  
- `src/entities/organization-user.entity.ts` - ç»„ç»‡ç”¨æˆ·å…³ç³»

### æœåŠ¡å±‚

- `src/services/organization.service.ts` - ç»„ç»‡æœåŠ¡ï¼ˆå¤åˆ¶è‡ªAPIï¼‰

### æµ‹è¯•æ–‡ä»¶

- `src/tests/organization.test.ts` - ç»„ç»‡ç›¸å…³æµ‹è¯•
- `src/tests/setup.ts` - æµ‹è¯•ç¯å¢ƒé…ç½®

### é…ç½®æ–‡ä»¶

- `src/config/database.ts` - æ•°æ®åº“é…ç½®
- `src/config/naming-strategy.ts` - å‘½åç­–ç•¥ï¼ˆä¸APIä¸€è‡´ï¼‰

## ğŸ› æ•…éšœæ’é™¤

### æ•°æ®åº“è¿æ¥é—®é¢˜

```bash
# æ£€æŸ¥ Docker å®¹å™¨çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker-compose logs postgres

# é‡å¯æ•°æ®åº“
docker-compose restart postgres
```

### æµ‹è¯•å¤±è´¥

```bash
# æ¸…ç†å¹¶é‡æ–°åˆå§‹åŒ–æ•°æ®åº“
npm run clean-db
npm run setup-db

# è¿è¡Œå•ä¸ªæµ‹è¯•
npm test -- --grep "specific test name"
```

### ç«¯å£å†²çª

å¦‚æœç«¯å£ 5432 è¢«å ç”¨ï¼Œä¿®æ”¹ `docker-compose.yml` ä¸­çš„ç«¯å£æ˜ å°„ï¼š

```yaml
ports:
  - "5433:5432"  # ä½¿ç”¨ 5433 ç«¯å£
```

ç„¶åæ›´æ–° `env.example` ä¸­çš„ç«¯å£é…ç½®ã€‚

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. æ·»åŠ æ–°çš„æµ‹è¯•ç”¨ä¾‹åˆ° `src/tests/` ç›®å½•
2. åˆ›å»ºæ–°çš„ç¤ºä¾‹åˆ° `examples/` ç›®å½•
3. æ‰©å±•å®ä½“å®šä¹‰ä»¥æµ‹è¯•æ›´å¤šåŠŸèƒ½
4. ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½å¹¶æ·»åŠ åŸºå‡†æµ‹è¯•

## ğŸ“š ç›¸å…³èµ„æº

- [TypeORM å®˜æ–¹æ–‡æ¡£](https://typeorm.io/)
- [Daytona API æºç ](../../apps/api/src/)
- [PostgreSQL æ–‡æ¡£](https://www.postgresql.org/docs/)
- [Jest æµ‹è¯•æ¡†æ¶](https://jestjs.io/)

---

è¿™ä¸ªé¡¹ç›®è®©æ‚¨å¯ä»¥å®‰å…¨åœ°å®éªŒå’Œå­¦ä¹  TypeORM Repository æ¨¡å¼ï¼ŒåŒæ—¶ç¡®ä¿æµ‹è¯•ç»“æœå¯¹å®é™…çš„ Daytona API å¼€å‘æœ‰å®é™…ä»·å€¼ã€‚
